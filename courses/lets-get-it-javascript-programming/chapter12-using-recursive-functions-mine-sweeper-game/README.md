# 12장 재귀 함수 사용하기_지뢰 찾기 게임

마지막 세 개 장에서는 지금까지 배운 개념을 모두 활용해 지뢰 찾기 게임, 2048 게임, 두더지 잡기 게임을 만드는 시간을 가진다. 새로운 개념도 나온다. 하지만 지금까지 배운 개념을 확실히 익히지 않았다면 앞으로 게임을 만들 때 엄청나게 고생할 것이다. 또한, 앞으로는 코드를 그냥 따라서 작성하지 말고 직접 구현해 보면서 책에 나온 코드와 얼마나 일치하는지, 어떤 점이 다른지 비교해 보면 더욱 좋다.

이 장에서 만드는 게임은 지뢰 찾기이다. 표 모양의 칸을 만들고 폭탄을 무작위로 배치해야 한다. 그리고 칸을 클릭하면 주변에 있는 지뢰 개수를 표시하고, 주변 칸이 빈칸이면 한 번에 모든 칸을 여는 작업도 필요하다. 또한, 칸을 우클릭하면 물음표나 깃발도 표시되게 해 보자. 기능이 많아 코드가 길어질 텐데, 코드가 아무리 길더라도 호출 스택과 이벤트 루프의 원리를 이용해 실행 순서를 파악할 수 있어야 한다.

## 12.1 순서도 그리기

처음에 표를 생성하는 절차와 칸을 좌클릭하는 절차, 우클릭하는 절차로 나뉜다.

<img src='./images/12-1.jpg' alt='그림 12-1 지뢰 찾기 순서도'/>

순서도에 칸 우클릭 이벤트에 물음표 칸인가에 대한 조건문이 잘못되어 있는 것 같다. 같은 조건이 두 번 반복된다. `닫힌 칸인가?`, `물음표 칸인가?`, `깃발 칸인가?`를 조합해서 다시 조건을 설정해야 한다. 물음표 -> 깃발 -> 닫힌 -> 물음표로 정하든가 깃발 -> 닫힘 -> 물음표 -> 깃발로 정하든 순서와 변화를 정해야 한다.

### 소스코드

```html
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>지뢰 찾기</title>
  <style>
    table { border-collapse: collapse; }
    td {
      border: 1px solid #bbb;
      text-align: center;
      line-height: 20px;
      width: 20px;
      height: 20px;
      background: #888;
    }
    td.opened { background: white; }
    td.flag { background: red; }
    td.question { background: orange; }
  </style>
</head>

<body>
  <table id="table">
    <tbody></tbody>
  </table>
  <div id="result"></div>
  <script>
    const $tbody = document.querySelector('#table tbody');
    const $result = document.querySelector('#result');
  </script>
</body>

</html>
```

앞으로는 글을 읽기 전에 어떻게 게임을 구성할지 스스로 먼저 생각해보자. 책에 나온 코드도 정답이 아니라 그저 하나의 예일 뿐이다. 책에 나온 코드만 따라 작성해서는 실력이 늘지 않는다.

그래서 읽기 전에 구성을 생각해본 것들을 아래에 정리하였다.

1. 가로 칸, 세로 줄에 대응되는 이차원 배열을 선언한다.
2. 가로, 세로, 지뢰 개수를 설정한다.
3. 피셔-예이츠 셔플을 이용하여 무작위로 이차원 배열에 지뢰를 심는다.
4. 좌클릭, 우클릭 상태를 저장할 변수를 선언하고 false로 초기화한다.
5. 데이터 시각화를 위해 HTML을 구성한다. (table)
6. 칸 좌클릭으로 물음표나 깃발이 있으면 대기한다.
7. 칸 좌클릭으로 지뢰인 경우 실패로 게임을 끝낸다.
8. 칸 좌클릭으로 폭탄이 아닌 경우 칸을 열고 주변 칸의 개수를 표시한다. 주변 칸의 수가 0이면 클릭한 칸을 열고 옆 칸을 같이 열 수 있으면 열어준다. 옆 칸의 기준을 파악하고 적용해야 한다. 그리고 모든 칸을 열었으면 승리를 표시하고 게임을 끝낸다. 아니라면 대기한다.
9. 칸 우클릭하면 웹에서 열리는 도구상자를 표시하지 않고 이벤트가 작동하도록 해야한다.
10. 칸 우클릭으로 이미 열린 칸이라면 대기한다.
11. 칸 우클릭으로 이미 열린 칸이 아니고 닫힌 칸이라면 깃발로 전환한다.
12. 칸 우클릭으로 이미 열린 칸이 아니고 물음표 칸이 아니라면
13. 칸 우클릭으로 이미 열린 칸이 아니고 물음표 칸이 아니라면 물음표로 전환한다.

가로 10칸, 세로 10줄, 지뢰 10개로 시작하겠다.

